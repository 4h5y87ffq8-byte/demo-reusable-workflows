name: Java Feature Workflow

on:
  workflow_call:

jobs:
  build:
    name: ğŸš€ Java Feature Build
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›ï¸ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ“¥ Export YAML entries as Env Vars
        uses: 4h5y87ffq8-byte/demo-reusable-workflows/.github/action/export-yaml-env@main
        with:
          file: .a5x_devops
          root_prefix: .a5x_devops

      - name: ğŸ’¾ Cache Maven Dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.m2/repository
          key: maven-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            maven-${{ runner.os }}-

      - name: â˜• Set up JDK ${{ env.a5x_devops__build__stack_version }}
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: ${{ env.a5x_devops__build__stack_version }}

      - name: ğŸ—ï¸ Build with Maven
        working-directory: ${{ env.a5x_devops__build__working_directory }}
        run: mvn clean install

      - name: âœ… Run Maven Quality Checks
        working-directory: ${{ env.a5x_devops__build__working_directory }}
        run: |
          mvn --batch-mode clean verify checkstyle:check pmd:check org.owasp:dependency-check-maven:check -T 1C -Dmaven.test.failure.ignore=false -DskipITs

  auto-pr:
    needs: build
    uses: 4h5y87ffq8-byte/demo-reusable-workflows/.github/workflows/feature-auto-pr-to-develop.yml@main
    secrets: inherit
