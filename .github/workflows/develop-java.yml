name: ğŸš§ Java Develop Workflow

on:
  workflow_call:

jobs:
  build-test-publish:
    name: ğŸ—ï¸ Build, Test & Publish
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›ï¸ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¥ Export YAML entries as env vars
        uses: 4h5y87ffq8-byte/demo-reusable-workflows/.github/action/export-yaml-env@main
        with:
          file: .a5x_devops
          root_prefix: .a5x_devops

      - name: ğŸ’¾ Cache Maven dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.m2/repository
          key: maven-${{ runner.os }}-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            maven-${{ runner.os }}-

      - name: â˜• Set up JDK ${{ env.a5x_devops__build__stack_version }}
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: ${{ env.a5x_devops__build__stack_version }}

      - name: ğŸ—ï¸ Build with Maven
        working-directory: ${{ env.a5x_devops__build__working_directory }}
        run: mvn clean install

      - name: ğŸ§ª Run Unit Tests
        working-directory: ${{ env.a5x_devops__build__working_directory }}
        run: mvn test

    #   - name: ğŸ“¦ Publish Artifact to Nexus
    #     working-directory: ${{ env.a5x_devops__build__working_directory }}
    #     env:
    #       NEXUS_USERNAME: ${{ secrets.NEXUS_USERNAME }}
    #       NEXUS_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}
    #     run: mvn deploy -DskipTests

    #   - name: ğŸ” Run SonarQube Analysis
    #     working-directory: ${{ env.a5x_devops__build__working_directory }}
    #     env:
    #       SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
    #     run: |
    #       mvn sonar:sonar \
    #         -Dsonar.projectKey=${{ env.a5x_devops__build__project_key }} \
    #         -Dsonar.host.url=${{ env.a5x_devops__build__sonar_host_url }} \
    #         -Dsonar.login=$SONAR_TOKEN
